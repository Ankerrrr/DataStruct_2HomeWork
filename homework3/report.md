# 41243243

# 41243244

### 組員名單

- 黃安可 41243243
- 黃順駿 41243243

第三題報告

# 分析總 K-way 外部排序輸入時間

## 解題說明

本題背景為在記憶體容量有限，排序資料量大於記憶體的情況下 (S << n)，使用課本 (程式 7-21) 進行外部排序

### 解題策略

本題分為兩個部分：

一、 推導輸入時間公式：需計算外部排序第二回合（K-way merge）階段的總輸入時間，時間因素包括：

1. 尋道時間 $t_s$

2. 延遲時間 $t_l$

3. 每筆資料的傳輸時間 $t_t$

二、 數值分析和圖表繪製：在給定相關參數下，繪製總輸入時間 $t_{input}$ 隨 $k$（每輪合併的 run 數）變化的圖形，並觀察是否存在某個 $k$ 值，使得 $t_{input} \approx t_{CPU}$，輸入所需時間與 CPU 處理時間相近。

### 符號定義

| 參數      | 解釋                          |
| --------- | ----------------------------- |
| $n$       | 資料總筆數                    |
| $m$       | 初始 run 數量                 |
| $S$       | 記憶體容量                    |
| $t_s$     | 磁碟 seek time（尋道時間）    |
| $t_l$     | 磁碟 latency time（延遲）     |
| $t_t$     | 傳送每筆資料的時間            |
| $t_{cpu}$ | CPU 合併所有 run 所花的總時間 |
| $k$       | 每輪合併的 run 數             |

## 程式實作

> [!NOTE]
> 由於本題為純粹計算題，因此本小節將作為解題說明

### 第一小題

題目要求推導總輸入時間，根據題意輸入時間包含以下:

1. $t_s$ 搜尋時間
2. $t_l$ 延遲時間
3. $t_t$ 傳輸每筆資料的時間

其中 $t_s$ 和 $t_l$ 為磁碟方面花費的時間，因此為每次的讀取資料的固定開銷，而 $t_t$ 則與資料筆數成正比，僅在資料實際傳輸過程中產生

於是我們可以經由以上推論，定義出以下公式:

### $t_{input}$ = ($n$ / $S$) × ($t_s$ + $t_l$) + $n$ × $t_t$

### 第二小題:

題目給定了參數值，我們將題目的參數值帶入，整理成以下表格:

| 參數      | 解釋                          | 數值             |
| --------- | ----------------------------- | ---------------- |
| $n$       | 資料總筆數                    | 200,000          |
| $m$       | 初始 run 數量                 | 64               |
| $S$       | 記憶體容量                    | 2,000            |
| $t_s$     | 磁碟 seek time（尋道時間）    | 80 ms = 0.08 sec |
| $t_l$     | 磁碟 latency time（延遲）     | 20 ms = 0.02 sec |
| $t_t$     | 傳送每筆資料的時間            | 0.001 sec        |
| $t_{cpu}$ | CPU 合併所有 run 所花的總時間 |                  |
| $k$       | 每輪合併的 run 數             |

將上述參數值帶入第一小提我們整理出的結論，得到以下結果:

### $t_{input}$ $({Single})$ = ($200,000  $ / $2,000$) × ($0.08$ + $0.02$) + $200,000$ × $0.001$

### $=$ $100$ $×$ $0.1$ $+$ $200$

得到

### $t_{input}$ $({Single})$ $=$ $210_{sec}$

接著由於每輪會合併的數量為 $k$ ， 而第一輪會產生 $m$ 個 $run$，推敲得出所需合併輪數為:

### $log_k$ $m$ $=$ $log_k$ $64$

### $t_{input}$ $({Total})$ = $t_{input}$ $({Single})$ $×$ $log_k$ $64$

我們使用 Excel 作圖，得到以下曲線

<img src="./src/img/chart1.png">

上圖為「輸入時間 $t_{input}$ 隨 $k$（每輪合併的 run 數）變化」的關係圖。可以觀察到以下幾點：

1. 整體趨勢為遞減：
   隨著 $k$ 值增加，每輪能同時合併的 run 數增加，因此所需的合併輪數 $\lceil \log_k m \rceil$ 減少，導致整體輸入時間大幅下降。

2. 下降幅度隨 $k$ 變大而趨緩：
   當 $k$ 從小值（如 $2$, $4$）增加時， $t_{input}$ 明顯下降，但當 $k$ 超過某一範圍（如 $k > 100$）後，輸入時間已趨於穩定，接近最低值，這是因為合併輪數已降至 1 或 2 輪，進一步增加 $k$ 的效益有限。

3. 選擇 $k$ 時的取捨考量：
   雖然理論上 $k$ 越大輸入時間越短，但實際上受限於記憶體容量、指標數量限制與程式實作複雜度，因此不能一味追求最大 $k$。選擇一個能顯著降低合併輪數，同時不增加過多管理負擔的 $k$ 值，才是實務上的合理策略。

### $t_{input} \approx t_{cpu}$ ?

本題假設 $t_{cpu}$ 為一個常數，並未給定一個明確數值， $t_{cpu}$ 表示 CPU 合併所有 run 所花的總時間， 而 $t_{input}$ 表示處理輸入資料所花費的時間

$t_{input}$ 將隨著 $k$ 遞減， $t_{cpu}$ 將保持不變，因此在某個 $k$ 值附近 $t_{input}$ 可能會接近 $t_{cpu}$。
